<!DOCTYPE html>
<html>
<head>
    <title>CodeMirror Test</title>
    <link rel="stylesheet" type="text/css" href="codemirror.css">
    <link rel="stylesheet" type="text/css" href="theme/monokai.css">
    <link rel="stylesheet" type="text/css" href="theme/pastel-on-dark.css">
    <link rel="stylesheet" type="text/css" href="addon/dialog/dialog.css">
    <link rel="stylesheet" type="text/css" href="addon/fold/foldgutter.css" />
    <style type="text/css">
    body{
        position: absolute;
        margin: 0;
        padding: 0;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
    }
    </style>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="codemirror.js"></script>
    <script src="keymap/sublime.js"></script>
    <script src="addon/dialog/dialog.js"></script>
    <script src="addon/search/searchcursor.js"></script>
    <script src="addon/search/search.js"></script>
    <script src="addon/scroll/annotatescrollbar.js"></script>
    <script src="addon/search/matchesonscrollbar.js"></script>
    <script src="addon/selection/active-line.js"></script>
</head>
<body>

</body>
<script>
    $('<style>.CodeMirror { width: 100% !important; height: 100% !important; font-family: '+editor.get_font()+'; }</style>').appendTo('head');
    var e = null;
    function load(){
        var options = {
            value: "",
            lineNumbers: true,
            autofocus: true,
            undoDepth: 0,
            dragDrop: false,
            theme: 'pastel-on-dark',
            styleActiveLine: true,
            indentUnit: 4,
            tabSize: 4,
            indentWithTabs: false,
            keyMap: "sublime",
            extraKeys: {
                "Tab": function (cm) {
                    if (cm.options.indentWithTabs)
                        cm.execCommand("insertTab");
                    else
                        cm.execCommand("insertSoftTab");
                }
            }
        };

        $.getScript('mode/' + editor.get_mode() + '.js')
            .done(function (data) {
                options['value'] = editor.content();
                options['mode'] = editor.get_mode();
                options['indentWithTabs'] = editor.uses_tabs();
                e = CodeMirror(document.body, options);
                e.on('change', function (cm, change) {
                    editor.change(cm.getValue());
                });
            })
            .fail(function(){
                if (editor.content()){
                    options['value'] = editor.content();
                }
                e = CodeMirror(document.body, options);
                e.on('change', function (cm, change) {
                    editor.change(cm.getValue());
                });
            });
    }
    var mode = load();
</script>
</html>